from google.cloud import bigquery

def hello_gcs(event, context):

  """Triggered by a change to a Cloud Storage bucket.
  Args:
      event (dict): Event payload.
      context (google.cloud.functions.Context): Metadata for the event.
  """

  print(f"Processing file: {event['name']}.")

  bucket_name=event['bucket']
  file_name=event['name']
  dataset_name = 'cfunc'
  table_name = 'function_gcs_to_bigquery_data'

  bq_client = bigquery.Client()

  dataset = bq_client.dataset(dataset_name)

  # Load data from Google Cloud Storage to BigQuery
  job_config = bigquery.LoadJobConfig()
  job_config.autodetect = True
  job_config.source_format = bigquery.SourceFormat.CSV

  uri = "gs://{}/{}".format(bucket_name, file_name)
  load_job = bq_client.load_table_from_uri(
      uri, dataset.table(table_name), job_config=job_config
  )

  load_job.result()
